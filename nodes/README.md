# 认识WebGL

1. 什么是WebGL

   WebGL是基于JavaScript语言的图形规范，浏览器厂商按照这组规范实现，为Web开发者提供一套`3D图形`相关的API，这些API能够让Web开发者使用的JAvaScript语言直接和显卡进行通信，当然WebGL部分也有对应的编程语言，简称`GLSL`。

2. WebGL工作原理

   WebGL 只能够绘制`点`、`线段`、`三角形`这三种基本图元，但是我们经常看到 WebGL 程序中含有立方体、球体、圆柱体等规则形体，甚至很多更复杂更逼真的不规则模型，那么 WebGL 是如何绘制它们？其实这些模型本质上是由一个一个的`点`组成，GPU 将这些点用`三角形图元`绘制成一个个的微小平面，这些平面之间互相连接，从而组成各种各样的立体模型。

   一般情况下，最初的顶点坐标是相对于`模型中心`的，不能直接传递到着色器中，我们需要对`顶点坐标`按照一系列步骤执行`模型转换`，`视图转换`，`投影转换`，转换之后的坐标才是 WebGL 可接受的坐标，即`裁剪空间坐标`。我们把最终的`变换矩阵`和`原始顶点坐标`传递给 `GPU`，GPU 的渲染管线对它们执行流水线作业。

   GPU 渲染管线的主要处理过程如下： 

   - 首先进入顶点着色器阶段，利用 GPU 的并行计算优势对顶点逐个进行坐标变换。
   - 然后进入图元装配阶段，将顶点按照图元类型组装成图形。
   - 接下来来到光栅化阶段，光栅化阶段将图形用不包含颜色信息的像素填充。
   - 在之后进入片元着色器阶段，该阶段为像素着色，并最终显示在屏幕上。

3. 什么是GLSL

   `GLSL` 的中文意思是 OpenGL 着色语言，英文全称是 OpenGL Shading Language，它是用来在 OpenGL 编写`着色器程序`的语言。

   - 着色器程序

     着色器程序是在显卡（GPU）上运行的简短程序，代替了 GPU `固定渲染管线`的一部分，使 GPU 渲染过程中的某些部分允许开发者通过`编程`进行控制。

   - WebGL渲染管线说明

     ![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/9/5/165a8dc3be028ca3~tplv-t2oaga2asx-watermark.awebp)

     上图演示WebGL对一个红色三角形的渲染过程，绿色部分为开发者可以通过编程控制的部分：

     - JavaScript 程序
       处理着色器需要的`顶点坐标`、`法向量`、`颜色`、`纹理`等信息，并负责为`着色器`提供这些数据，上图为了演示方便，只是提供了三角形顶点的位置数据。
     - 顶点着色器
       接收 JavaScript 传递过来的`顶点信息`，将顶点绘制到对应坐标。
     - 图元装配阶段
       将三个顶点装配成指定`图元类型`，上图采用的是三角形图元。
     - 光栅化阶段 将三角形内部区域用空像素进行填充。
     - 片元着色器 为三角形内部的像素填充颜色信息，上图为暗红色。

      对顶点信息的变换操作既可以在 `JavaScript` 中进行，也可以在`着色器程序`中进行。通常我们都是在 `JavaScript` 中生成一个包含了所有变换的最终变换矩阵，然后将该矩阵传递给着色器，利用 GPU 并行计算优势对所有顶点执行变换。

      

     
